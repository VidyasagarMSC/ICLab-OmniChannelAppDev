<!DOCTYPE html>
<html lang="en">
<head>
    <link rel='stylesheet' href='stylesheets/protected.css'/>
      <link rel="manifest" href="manifest.json">
</head>
<body>
<div id="maindiv" class="main-container">
    <div class="top-container">
        <div class="flex-top">
            <img id="userProfileImg" class="user-profile" src="images/placeholder-hi.png">
        </div>
        <div class="flex-top">
        <h1>Hi <span id="userNameSpan"></span>,</h1>
        <h1>Welcome to BMDService .</h1>
        <div class="flex-top">
          <button class="button" onclick="registerPush();">Enable Push</button>
        </div>
        <div class="flex-top"><button class="button" onclick="enableAnalytics();">Enable Analytics</button></div>
      <div class="flex-top">
        <button class="button" onclick="sendAnalytics();">Send Analytics</button>
      </div>
      </div>
      
      <div class="flex-top"></div>
        </div>
    </div>
   <div class="bottom-container">
      <div class="flex-bottom">
        <h2>You are using IBM credentials. <br/>We encourage you to go edit Facebook/Google settings in the console.</h2>
      </div>
      <div id="container1">
        <div class="one"> <img class='resize_fit_center1' src="images/IBMBlueMix.png">
        </div>
      </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.1.1.js"></script>
<script>

	$("#maindiv").attr('style', 'visibility: visible');
    $('#userNameSpan').html('<%= name %>');
    $('#userProfileImg').attr('src', '<%- picture %>');


    //alert(JSON.stringify(tokens));
    //window.sessionStorage.setItem('idTokenInfo', JSON.stringify(tokens.identityTokenPayload));
    //window.sessionStorage.setItem('accessTokenInfo', JSON.stringify(tokens.accessTokenPayload));

</script>
<script src="BMSPushSDK.js"></script>
<script src="bmsanalytics.js"></script>
<script>
  function registerPush(){

    var bmsPush = new BMSPush()
    function callback(response) {
      alert(response.response)
    }
    var initParams = {
      "appGUID":"ee011cf4-556c-43e8-a659-8ab006bbda99",
      "appRegion":".ng.bluemix.net",
      "clientSecret":"91700456-a16b-44e1-9595-2b08a01f4a39"
    }

    var userId = "kg"
    bmsPush.initialize(initParams, callback)
    bmsPush.registerWithUserId(userId,function(response) {
      alert(response.response)
    })

  }

  function enableAnalytics(){

    var appName = "OmniChannel Mobile Analytics";
  var apiKey = "e6362b9d-c41b-4736-bc46-5bd585b5bf3f";
  var hasUserContext=true; 
  var tenantId = "dbe5243f-9c9d-4cda-9db8-d598a3f1e068";
  BMSAnalytics.Client.initialize(BMSAnalytics.Client.REGION_US_SOUTH);
  BMSAnalytics.initialize(appName,apiKey,hasUserContext,BMSAnalytics.DeviceEvents.ALL,tenantId);
  BMSAnalytics.enable();
  }
  function sendAnalytics(){
    BMSAnalytics.log({'customLog3':'customValue3'});
    BMSAnalytics.Logger.setMaxLogStoreSize(10000);
    BMSAnalytics.Logger.setLogLevel('trace');
    console.log('warn');
         BMSAnalytics.Logger.warn({'customLog':'warn'});

        
        console.log('error');
        BMSAnalytics.Logger.error({'customLog':'error'});

        console.log('fatal');
         BMSAnalytics.Logger.fatal({'customLog':'fatal'});

         BMSAnalytics.Logger.send();
        console.log('--------'+BMSAnalytics.Logger.isStoringLogs());

        console.log('send Logs'); 
    var promise=BMSAnalytics.send();

        promise.then(function(result) {
          console.log(result); // "Stuff worked!"
        }, function(err) {
          console.log(err); // Error: "It broke"
        });
  }
  </script>
</body>
</html>